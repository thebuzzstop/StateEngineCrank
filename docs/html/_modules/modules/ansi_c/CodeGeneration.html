
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>modules.ansi_c.CodeGeneration &#8212; StateEngineCrank 20190308 documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for modules.ansi_c.CodeGeneration</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on May 19, 2016</span>

<span class="sd">@author:    Mark Sawyer</span>
<span class="sd">@date:      20-May-2016</span>

<span class="sd">@package:   StateEngineCrank</span>
<span class="sd">@brief:     Code Generation (Ansi-C State Engine)</span>
<span class="sd">@details:   Code Generation for StateEngineCrank</span>

<span class="sd">@copyright: Mark B Sawyer, All Rights Reserved 2016</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># System imports</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading modules: </span><span class="si">%s</span><span class="s1"> as </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">))</span>

<span class="c1"># Project specific imports</span>
<span class="kn">import</span> <span class="nn">modules.ansi_c.CodeScan</span>  <span class="c1"># noqa 408</span>
<span class="kn">import</span> <span class="nn">modules.ErrorHandling</span>    <span class="c1"># noqa 408</span>
<span class="kn">import</span> <span class="nn">modules.FileSupport</span>      <span class="c1"># noqa 408</span>
<span class="kn">import</span> <span class="nn">modules.ansi_c.Signature</span>  <span class="c1"># noqa 408</span>
<span class="kn">import</span> <span class="nn">modules.UMLParse</span>         <span class="c1"># noqa 408</span>


<div class="viewcode-block" id="CodeGen"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen">[docs]</a><span class="k">class</span> <span class="nc">CodeGen</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Code Generation for StateEngineCrank &quot;&quot;&quot;</span>

    <span class="n">CODE_LINE_TERMINATOR</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span>
    <span class="n">BLANK_LINE</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">TAB_SPACES</span> <span class="o">=</span> <span class="s1">&#39;    &#39;</span>

    <span class="n">FUNCTION_CLOSE</span> <span class="o">=</span> <span class="s1">&#39;}&#39;</span>
    <span class="n">FUNCTION_PARENS</span> <span class="o">=</span> <span class="s1">&#39;(id)&#39;</span>

    <span class="n">SWITCH_START</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;    switch (GET_CURRENT_STATE(id)) // dispatch according to current state&#39;</span><span class="p">,</span>
        <span class="s1">&#39;    {&#39;</span><span class="p">]</span>

    <span class="n">SWITCH_DELIMIT</span> <span class="o">=</span> <span class="s1">&#39;:&#39;</span>
    <span class="n">SWITCH_CASE</span> <span class="o">=</span> <span class="s1">&#39;        case &#39;</span>
    <span class="n">SWITCH_CASE_GUARD_IF</span> <span class="o">=</span> <span class="s1">&#39;            if (&#39;</span>
    <span class="n">SWITCH_CASE_GUARD_IF2</span> <span class="o">=</span> <span class="s1">&#39;) {&#39;</span>
    <span class="n">SWITCH_CASE_GUARD_CLOSE</span> <span class="o">=</span> <span class="s1">&#39;            }&#39;</span>
    <span class="n">SWITCH_CASE_GUARD_ELSE</span> <span class="o">=</span> <span class="s1">&#39;            } else&#39;</span>
    <span class="n">SWITCH_CASE_GUARD_ELSE2</span> <span class="o">=</span> <span class="s1">&#39;            } else {&#39;</span>

    <span class="n">SWITCH_CASE_INDENT</span> <span class="o">=</span> <span class="s1">&#39;            &#39;</span>
    <span class="n">SWITCH_CASE_INDENT2</span> <span class="o">=</span> <span class="s1">&#39;                &#39;</span>
    <span class="n">SWITCH_BREAK</span> <span class="o">=</span> <span class="s1">&#39;            break;&#39;</span>
    <span class="n">SWITCH_CLOSE</span> <span class="o">=</span> <span class="s1">&#39;    }&#39;</span>

    <span class="n">STATES_TYPEDEF_START</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;typedef enum STATES {&#39;</span><span class="p">,</span>
        <span class="s1">&#39;    InitialState = -1, //!&lt; initial state is automatic&#39;</span><span class="p">]</span>

    <span class="n">STATES_TYPEDEF_END</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;    FinalState = -2 //!&lt; final state is automatic&#39;</span><span class="p">,</span>
        <span class="s1">&#39;} State;&#39;</span><span class="p">]</span>

    <span class="n">MAIN_PROTOTYPES</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;static void StateEngineCrank_MainDoLoop(int id);&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_HEADER</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;/**&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * ===========================================================================&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * @brief StateEngineCrank - Main Loop&#39;</span><span class="p">,</span>
        <span class="s1">&#39; *&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * @details This is the main state machine processing loop.&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * ===========================================================================&#39;</span><span class="p">,</span>
        <span class="s1">&#39; */&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_DECLARATION</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;static void StateEngineCrank_MainDoLoop(int id)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;{&#39;</span><span class="p">,</span>
        <span class="s1">&#39;    STATE_ENGINE_INITIALIZE_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;loop:&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_CLOSE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;goto loop;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;    STATE_ENGINE_TERMINATE_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;}&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_SWITCH_USER_DO</span> <span class="o">=</span> <span class="s1">&#39;            &#39;</span>
    <span class="n">MAIN_LOOP_SWITCH_INITIAL</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;        case InitialState:&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            MAIN_LOOP_INITIAL_STATE_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            break;&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_SWITCH_FINAL</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;        case FinalState:&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            MAIN_LOOP_FINAL_STATE_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            break;&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_SWITCH_DEFAULT</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;        default:&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            MAIN_LOOP_DEFAULT_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            break;&#39;</span><span class="p">]</span>

    <span class="n">MAIN_LOOP_INITIAL_STATE_HOOK</span> <span class="o">=</span> <span class="s1">&#39;MAIN_LOOP_INITIAL_STATE_HOOK(id)&#39;</span>
    <span class="n">MAIN_LOOP_FINAL_STATE_HOOK</span> <span class="o">=</span> <span class="s1">&#39;MAIN_LOOP_FINAL_STATE_HOOK(id)&#39;</span>
    <span class="n">MAIN_LOOP_DEFAULT_HOOK</span> <span class="o">=</span> <span class="s1">&#39;MAIN_LOOP_DEFAULT_HOOK(id)&#39;</span>

    <span class="n">NUM_THREADS_HOOK</span> <span class="o">=</span> <span class="s1">&#39;NUM_THREADS&#39;</span>

    <span class="n">GET_CURRENT_STATE</span> <span class="o">=</span> <span class="s1">&#39;GET_CURRENT_STATE(id)&#39;</span>
    <span class="n">SET_CURRENT_STATE</span> <span class="o">=</span> <span class="s1">&#39;SET_CURRENT_STATE(id, state)&#39;</span>

    <span class="n">STATE_ENGINE_RUNNING</span> <span class="o">=</span> <span class="s1">&#39;STATE_ENGINE_RUNNING(id)&#39;</span>

    <span class="n">STATE_ENGINE_INITIALIZE_HOOK</span> <span class="o">=</span> <span class="s1">&#39;STATE_ENGINE_INITIALIZE_HOOK(id)&#39;</span>
    <span class="n">STATE_ENGINE_TERMINATE_HOOK</span> <span class="o">=</span> <span class="s1">&#39;STATE_ENGINE_TERMINATE_HOOK(id)&#39;</span>
    <span class="n">EVT_HANDLER_DEFAULT_HOOK</span> <span class="o">=</span> <span class="s1">&#39;EVT_HANDLER_DEFAULT_HOOK(id)&#39;</span>

    <span class="n">HOOK_IFNDEF</span> <span class="o">=</span> <span class="s1">&#39;#ifndef &#39;</span>
    <span class="n">HOOK_DEFINE</span> <span class="o">=</span> <span class="s1">&#39;#define &#39;</span>
    <span class="n">HOOK_ENDIF</span> <span class="o">=</span> <span class="s1">&#39;#endif&#39;</span>

    <span class="n">EVT_TAG</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{EVT_TAG}</span><span class="s1">&#39;</span>
    <span class="n">EVT_PROTO</span> <span class="o">=</span> <span class="s1">&#39;static void </span><span class="si">{EVT_TAG}</span><span class="s1">(int id);&#39;</span>

    <span class="n">EVT_HANDLER_HEADER_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;/**&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * ===========================================================================&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * @brief Event processing </span><span class="si">{EVT_TAG}</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="s1">&#39; *&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * @details State machine event processing for </span><span class="si">{EVT_TAG}</span><span class="s1">.&#39;</span><span class="p">,</span>
        <span class="s1">&#39; *          This function needs to be called whenever the event&#39;</span><span class="p">,</span>
        <span class="s1">&#39; *          </span><span class="si">{EVT_TAG}</span><span class="s1"> is detected.&#39;</span><span class="p">,</span>
        <span class="s1">&#39; * ===========================================================================&#39;</span><span class="p">,</span>
        <span class="s1">&#39; */&#39;</span><span class="p">]</span>

    <span class="n">EVT_DECLARATION_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;static void </span><span class="si">{EVT_TAG}</span><span class="s1">(int id)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;{&#39;</span><span class="p">]</span>

    <span class="n">EVT_HANDLER_SWITCHDEF_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;        default:&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            EVT_HANDLER_DEFAULT_HOOK(id);&#39;</span><span class="p">,</span>
        <span class="s1">&#39;            break;&#39;</span><span class="p">]</span>

    <span class="n">STATE_TAG</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{STATE_TAG}</span><span class="s1">&#39;</span>
    <span class="n">EVT_HANDLER_CURSTATE_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;SET_CURRENT_STATE(id, </span><span class="si">{STATE_TAG}</span><span class="s1">);&#39;</span>

    <span class="n">MissingPrototypes</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of prototypes missing in source file</span>
    <span class="n">MissingFunctions</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of functions missing in source file</span>

    <span class="n">VOID_FUNC_TAG</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{VOID_FUNC_TAG}</span><span class="s1">&#39;</span>
    <span class="n">VOID_FUNC_PROTO_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;static void </span><span class="si">{VOID_FUNC_TAG}</span><span class="s1">(int id);&#39;</span>
    <span class="n">VOID_FUNC_HEADER_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/**&#39;</span><span class="p">,</span> <span class="s1">&#39; * @todo FIXME&#39;</span><span class="p">,</span> <span class="s1">&#39; */&#39;</span><span class="p">]</span>
    <span class="n">VOID_FUNC_DECL_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;static void </span><span class="si">{VOID_FUNC_TAG}</span><span class="s1">(int id)&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">]</span>
    <span class="n">VOID_FUNC_CLOSE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;    return;&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span>

    <span class="n">GUARD_FUNC_TAG</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{GUARD_FUNC_TAG}</span><span class="s1">&#39;</span>
    <span class="n">GUARD_FUNC_PROTO_TEMPLATE</span> <span class="o">=</span> <span class="s1">&#39;static BOOL_TYPE </span><span class="si">{GUARD_FUNC_TAG}</span><span class="s1">(int id);&#39;</span>
    <span class="n">GUARD_FUNC_HEADER_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/**&#39;</span><span class="p">,</span> <span class="s1">&#39; * @todo FIXME&#39;</span><span class="p">,</span> <span class="s1">&#39; */&#39;</span><span class="p">]</span>
    <span class="n">GUARD_FUNC_DECL_TEMPLATE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;static BOOL_TYPE </span><span class="si">{GUARD_FUNC_TAG}</span><span class="s1">(int id)&#39;</span><span class="p">,</span> <span class="s1">&#39;{&#39;</span><span class="p">]</span>
    <span class="n">GUARD_FUNC_CLOSE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;    return TRUE;&#39;</span><span class="p">,</span> <span class="s1">&#39;}&#39;</span><span class="p">]</span>

    <span class="n">re_hook</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;hook&gt;[a-zA-Z_]+[a-zA-Z0-9_]*)&#39;</span><span class="p">)</span>

    <span class="c1"># =========================================================================</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; CodeGeneration module initialization. &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;CodeGeneration ID: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">ansi_c</span><span class="o">.</span><span class="n">CodeScan</span><span class="o">.</span><span class="n">CodeScan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">ErrorHandling</span><span class="o">.</span><span class="n">Error</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">FileSupport</span><span class="o">.</span><span class="n">File</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">ansi_c</span><span class="o">.</span><span class="n">Signature</span><span class="o">.</span><span class="n">Signature</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uml</span> <span class="o">=</span> <span class="n">modules</span><span class="o">.</span><span class="n">UMLParse</span><span class="o">.</span><span class="n">UML</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.update_code"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.update_code">[docs]</a>    <span class="k">def</span> <span class="nf">update_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Update source file code. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_state_engine_enums</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_state_engine_prototypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_state_engine_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_state_engine_defines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_state_engine_code</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_enums</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_prototypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_variables</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_defines</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_main_loop</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_event_functions</span><span class="p">()</span>

        <span class="c1"># delete any missing functions/prototypes from previous scans</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingFunctions</span><span class="p">[:]</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingPrototypes</span><span class="p">[:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_enter_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_do_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_exit_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_guard_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_transition_functions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_prototypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_functions</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">dump_file</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">dump_uml</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">dump_prototypes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">dump_functions</span><span class="p">()</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_main_prototypes"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_main_prototypes">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_prototypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create main state engine prototypes. &quot;&quot;&quot;</span>

        <span class="c1"># find current state engine comment and bump to first line of code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_state_engine_code_proto_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_PROTOTYPES</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>

        <span class="c1"># add event handler prototypes</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EVT_PROTO</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVT_TAG</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_main_defines"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_main_defines">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_defines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create main state engine defines. &quot;&quot;&quot;</span>

        <span class="c1"># find current state engine comment and bump to first line of code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_state_engine_code_defines_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>

        <span class="c1"># add conditionals here (#ifdef&#39;s)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NUM_THREADS_HOOK</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GET_CURRENT_STATE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SET_CURRENT_STATE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_ENGINE_RUNNING</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_ENGINE_INITIALIZE_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATE_ENGINE_TERMINATE_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EVT_HANDLER_DEFAULT_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_INITIAL_STATE_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_FINAL_STATE_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_DEFAULT_HOOK</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_main_enums"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_main_enums">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_enums</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create main state engine enumerations. &quot;&quot;&quot;</span>

        <span class="c1"># find current state engine comment and bump to first line of code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_state_engine_code_enums_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>

        <span class="c1"># add typedef&#39;s for states enumeration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATES_TYPEDEF_START</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STATES_TYPEDEF_END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_main_variables"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_main_variables">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create main state engine variables. &quot;&quot;&quot;</span>

        <span class="c1"># find current state variable comment and bump to first line of code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_state_engine_code_variables_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_main_loop"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_main_loop">[docs]</a>    <span class="k">def</span> <span class="nf">create_main_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create main state engine monitoring loop. &quot;&quot;&quot;</span>

        <span class="c1"># find current state engine comment and bump to first line of code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_state_engine_code_start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>

        <span class="c1"># main loop function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_HEADER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_DECLARATION</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_START</span><span class="p">)</span>

        <span class="c1"># add a switch-case for each state</span>
        <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_switch_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="c1"># close out the main switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_SWITCH_INITIAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_SWITCH_FINAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_SWITCH_DEFAULT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CLOSE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_CLOSE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.create_event_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.create_event_functions">[docs]</a>    <span class="k">def</span> <span class="nf">create_event_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create event function handlers. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.update_user_prototypes"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.update_user_prototypes">[docs]</a>    <span class="k">def</span> <span class="nf">update_user_prototypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create/Update user prototypes. &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Missing User Prototypes: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingPrototypes</span><span class="p">)</span>
        <span class="c1"># early exit if no missing prototypes</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissingPrototypes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># find current user prototype end comment and backup to insert missing</span>
        <span class="c1"># user prototypes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_user_code_proto_end</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">proto</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissingPrototypes</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">is_guard</span><span class="p">(</span><span class="n">proto</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_PROTO_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_TAG</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_PROTO_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_TAG</span><span class="p">,</span> <span class="n">proto</span><span class="p">)</span></div>

    <span class="c1"># =============================================================================================</span>
<div class="viewcode-block" id="CodeGen.update_user_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.update_user_functions">[docs]</a>    <span class="k">def</span> <span class="nf">update_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Create/Update user functions. &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Missing User Functions: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">MissingFunctions</span><span class="p">)</span>
        <span class="c1"># early exit if no missing functions</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissingFunctions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># find current user code end comment and backup to insert missing</span>
        <span class="c1"># user functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_user_code_end</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MissingFunctions</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">is_guard</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_HEADER_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_DECL_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">GUARD_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_HEADER_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_DECL_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">VOID_FUNC_TAG</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></div>

    <span class="c1"># =============================================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML functions. &quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;FuncList: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func_list</span><span class="p">)</span>
        <span class="c1"># scan code for missing functions/prototypes</span>
        <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">func_list</span><span class="p">:</span>
            <span class="c1"># check for prototypes</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">find_prototype</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MissingPrototypes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Missing prototype: </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Found prototype: </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span>

            <span class="c1"># check for functions</span>
            <span class="n">found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="o">.</span><span class="n">find_function</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MissingFunctions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Missing function: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Found function: </span><span class="si">%s</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">func</span><span class="p">)</span></div>

    <span class="c1"># =============================================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_enter_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_enter_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_enter_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML enter</span>
<span class="sd">            functions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">enters</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_do_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_do_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_do_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML enter</span>
<span class="sd">            functions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">dos</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_exit_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_exit_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_exit_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML exit</span>
<span class="sd">            functions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">exits</span><span class="o">.</span><span class="n">values</span><span class="p">())</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_guard_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_guard_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_guard_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML guard</span>
<span class="sd">            functions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">gfuncs</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.find_user_transition_functions"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.find_user_transition_functions">[docs]</a>    <span class="k">def</span> <span class="nf">find_user_transition_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Scan current list of prototypes and functions for UML transition</span>
<span class="sd">            functions. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_user_functions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">tfuncs</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_lines_template"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_lines_template">[docs]</a>    <span class="k">def</span> <span class="nf">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines_text</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add lines of text to file in memory using template. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line_text</span> <span class="ow">in</span> <span class="n">lines_text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line_template</span><span class="p">(</span><span class="n">line_text</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_lines"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_lines">[docs]</a>    <span class="k">def</span> <span class="nf">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines_text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add lines of text to file in memory. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">line_text</span> <span class="ow">in</span> <span class="n">lines_text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line_text</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_line_template"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_line_template">[docs]</a>    <span class="k">def</span> <span class="nf">add_line_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_text</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add line of text to file in memory using template. &quot;&quot;&quot;</span>
        <span class="c1"># make text substitutions for caller</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">line_text</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="c1"># currentLine needs to be 0-relative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">insert_line_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">1</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_line"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_line">[docs]</a>    <span class="k">def</span> <span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add line of text to file in memory. &quot;&quot;&quot;</span>
        <span class="c1"># currentLine needs to be 0-relative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">insert_line_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_line</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">line_text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_line</span> <span class="o">+</span> <span class="mi">1</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_lines"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_lines">[docs]</a>    <span class="k">def</span> <span class="nf">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_signature</span><span class="p">,</span> <span class="n">end_signature</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete lines from file in memory based on location of signature. &quot;&quot;&quot;</span>
        <span class="c1"># find start and end and delete</span>
        <span class="n">result_start</span><span class="p">,</span> <span class="n">line_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_signature</span><span class="p">(</span><span class="n">start_signature</span><span class="p">)</span>
        <span class="n">result_end</span><span class="p">,</span> <span class="n">line_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">find_signature</span><span class="p">(</span><span class="n">end_signature</span><span class="p">)</span>

        <span class="c1"># sanity check the start and end</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">result_start</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">result_end</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">invalid_start_end</span><span class="p">(</span><span class="n">line_start</span><span class="p">,</span> <span class="n">line_end</span><span class="p">)</span>

        <span class="c1"># adjust the start and end line numbers</span>
        <span class="n">line_start</span> <span class="o">=</span> <span class="n">line_start</span> <span class="o">+</span> <span class="mi">2</span>   <span class="c1"># start past the START signature</span>
        <span class="n">line_end</span> <span class="o">=</span> <span class="n">line_end</span> <span class="o">-</span> <span class="mi">2</span>       <span class="c1"># stop before the END signature</span>

        <span class="c1"># delete a range of lines</span>
        <span class="c1"># print &quot;Delete lines &quot;, line_start, &quot; thru &quot;, line_end</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">line_start</span><span class="p">,</span> <span class="n">line_end</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">line_offset</span> <span class="o">=</span> <span class="n">line_end</span> <span class="o">-</span> <span class="n">line</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">delete_line</span><span class="p">(</span><span class="n">line_start</span><span class="o">+</span><span class="n">line_offset</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_state_engine_code"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_state_engine_code">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state_engine_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete all state engine code. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_START</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_END</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_state_engine_defines"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_state_engine_defines">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state_engine_defines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete all state engine defines. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_DEFINES_START</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_DEFINES_END</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_state_engine_enums"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_state_engine_enums">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state_engine_enums</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete all state engine enumerations. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_ENUMS_START</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_ENUMS_END</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_state_engine_prototypes"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_state_engine_prototypes">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state_engine_prototypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete all state engine prototypes. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_PROTOTYPES_START</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_PROTOTYPES_END</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.delete_state_engine_variables"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.delete_state_engine_variables">[docs]</a>    <span class="k">def</span> <span class="nf">delete_state_engine_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Delete all state engine variables. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delete_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_VARIABLES_START</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="o">.</span><span class="n">MAIN_CODE_VARIABLES_END</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_switch_state"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_switch_state">[docs]</a>    <span class="k">def</span> <span class="nf">add_switch_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add a switch case (state) to source file in memory. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE</span> <span class="o">+</span> <span class="n">state</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_DELIMIT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">dos</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAIN_LOOP_SWITCH_USER_DO</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">dos</span><span class="p">[</span><span class="n">state</span><span class="p">]</span> <span class="o">+</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_PARENS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CODE_LINE_TERMINATOR</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_BREAK</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_conditional_hook"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_conditional_hook">[docs]</a>    <span class="k">def</span> <span class="nf">add_conditional_hook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add #ifndef conditional hook to source file in memory. &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_hook</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hook_ifdef</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hook_ifdef</span> <span class="o">=</span> <span class="n">hook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_IFNDEF</span> <span class="o">+</span> <span class="n">hook_ifdef</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_DEFINE</span> <span class="o">+</span> <span class="n">hook</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_ENDIF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_conditional_hook_param"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_conditional_hook_param">[docs]</a>    <span class="k">def</span> <span class="nf">add_conditional_hook_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add #ifndef conditional hook to source file in memory. &quot;&quot;&quot;</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">re_hook</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">hook</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hook_ifdef</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;hook&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">hook_ifdef</span> <span class="o">=</span> <span class="n">hook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_IFNDEF</span> <span class="o">+</span> <span class="n">hook_ifdef</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_DEFINE</span> <span class="o">+</span> <span class="n">hook</span> <span class="o">+</span> <span class="n">param</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HOOK_ENDIF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_event_handler"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_event_handler">[docs]</a>    <span class="k">def</span> <span class="nf">add_event_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add event handler function to source file in memory. &quot;&quot;&quot;</span>
        <span class="c1"># create event handler function header</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EVT_HANDLER_HEADER_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVT_TAG</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

        <span class="c1"># create event handler function declaration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines_template</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EVT_DECLARATION_TEMPLATE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">EVT_TAG</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

        <span class="c1"># create event handler function switch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_START</span><span class="p">)</span>

        <span class="c1"># create switch cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_event_switch_cases</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="c1"># create switch default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_lines</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EVT_HANDLER_SWITCHDEF_TEMPLATE</span><span class="p">)</span>

        <span class="c1"># close out the switch and event function handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CLOSE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_CLOSE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BLANK_LINE</span><span class="p">)</span></div>

    <span class="c1"># =========================================================================</span>
<div class="viewcode-block" id="CodeGen.add_event_switch_cases"><a class="viewcode-back" href="../../../modules.ansi_c.html#modules.ansi_c.CodeGeneration.CodeGen.add_event_switch_cases">[docs]</a>    <span class="k">def</span> <span class="nf">add_event_switch_cases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add event switch cases to current event function being created. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">dump_uml</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">state1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">states</span><span class="p">:</span>

            <span class="c1"># start the switch case</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE</span> <span class="o">+</span> <span class="n">state1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_DELIMIT</span><span class="p">)</span>

            <span class="c1"># set True if we are actively processing guards</span>
            <span class="n">guard_active</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># switch_case_code_indent used when indenting switch case code</span>
            <span class="c1"># this is adjusted if processing guards</span>
            <span class="n">switch_case_code_indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_INDENT</span>

            <span class="c1"># scan transitions for this event in this state</span>
            <span class="c1"># scan for transitions that have a [guard] first</span>
            <span class="k">for</span> <span class="n">has_guard</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">transition</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">transitions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;event&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">event</span> <span class="ow">and</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;state1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">state1</span><span class="p">:</span>

                        <span class="c1"># establish components of this transition</span>
                        <span class="n">state2</span> <span class="o">=</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;state2&#39;</span><span class="p">]</span>
                        <span class="n">guard</span> <span class="o">=</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;guard&#39;</span><span class="p">]</span>

                        <span class="c1"># test if we are processing [guards]</span>
                        <span class="k">if</span> <span class="n">has_guard</span> <span class="ow">and</span> <span class="n">guard</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_guard</span> <span class="ow">and</span> <span class="n">guard</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>

                        <span class="c1"># check for a guard function</span>
                        <span class="k">if</span> <span class="n">guard</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="c1"># if we are already processing a guard then add the closing bracket</span>
                            <span class="k">if</span> <span class="n">guard_active</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_GUARD_ELSE</span><span class="p">)</span>
                            <span class="c1"># add the if (guard()) {</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_GUARD_IF</span> <span class="o">+</span> <span class="n">guard</span> <span class="o">+</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_PARENS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_GUARD_IF2</span><span class="p">)</span>
                            <span class="c1"># increase the indent and flag that a guard is active</span>
                            <span class="n">switch_case_code_indent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_INDENT2</span>
                            <span class="n">guard_active</span> <span class="o">=</span> <span class="kc">True</span>     <span class="c1"># flag that guard logic is active</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># if we have already processed a guard then add the closing bracket</span>
                            <span class="k">if</span> <span class="n">guard_active</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_GUARD_ELSE2</span><span class="p">)</span>

                        <span class="c1"># add exit function if it exists</span>
                        <span class="c1"># if self.uml.exits.has_key(state1):</span>
                        <span class="k">if</span> <span class="n">state1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">exits</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">switch_case_code_indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">exits</span><span class="p">[</span><span class="n">state1</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_PARENS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CODE_LINE_TERMINATOR</span><span class="p">)</span>

                        <span class="c1"># add transition function if it exists</span>
                        <span class="k">if</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">switch_case_code_indent</span> <span class="o">+</span> <span class="n">transition</span><span class="p">[</span><span class="s1">&#39;trans&#39;</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_PARENS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CODE_LINE_TERMINATOR</span><span class="p">)</span>

                        <span class="c1"># set state variable to new state</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">add_line_template</span><span class="p">(</span><span class="n">switch_case_code_indent</span> <span class="o">+</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">EVT_HANDLER_CURSTATE_TEMPLATE</span><span class="p">,</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">STATE_TAG</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span>

                        <span class="c1"># add entry function if it exists</span>
                        <span class="c1"># if self.uml.enters.has_key(state2):</span>
                        <span class="k">if</span> <span class="n">state2</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">enters</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">switch_case_code_indent</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">uml</span><span class="o">.</span><span class="n">enters</span><span class="p">[</span><span class="n">state2</span><span class="p">]</span> <span class="o">+</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">FUNCTION_PARENS</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">CODE_LINE_TERMINATOR</span><span class="p">)</span>

            <span class="c1"># close out guard if active</span>
            <span class="k">if</span> <span class="n">guard_active</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_CASE_GUARD_CLOSE</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SWITCH_BREAK</span><span class="p">)</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">StateEngineCrank</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">source</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Mark Sawyer under the terms of GPLv3.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>